<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0,
maximum-scale=1.0, user-scalable=no">
<title>AR VR Mode</title>
<style>
html,body{
  margin:0;
  overflow:hidden;
  background:black;
  font-family:sans-serif;
}
#menu{
  position:absolute;
  left:40px;
  top:50%;
  transform:translateY(-50%);
  display:flex;
  flex-direction:column;
  gap:20px;
  background:rgba(0,0,0,0.35);
  padding:20px;
  border-radius:20px;
  backdrop-filter:blur(15px);
}
.menuItem{
  padding:18px 28px;
  font-size:22px;
  border-radius:15px;
  background:rgba(255,255,255,0.15);
  color:white;
  transition:0.2s;
}
.menuItem.hover{
  background:lime;
  color:black;
  transform:scale(1.08);
}
.menuItem.active{
  background:lime;
  color:black;
}
</style>
</head>
<body>

<video id="video" autoplay playsinline style="display:none"></video>

<div id="menu">
  <div class="menuItem">Einstellungen ‚öôÔ∏è</div>
  <div class="menuItem">App Store üõí</div>
  <div class="menuItem">Games üéÆ</div>
  <div class="menuItem">Standby üí°</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

<script>
// ---------- THREE ----------
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  90, // breiter f√ºr VR Feeling
  window.innerWidth/window.innerHeight,
  0.1,
  1000
);
camera.position.z = 6;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setScissorTest(true);
document.body.appendChild(renderer.domElement);

// Sky Gradient
const skyGeo = new THREE.SphereGeometry(100,32,32);
const skyMat = new THREE.ShaderMaterial({
  side:THREE.BackSide,
  uniforms:{
    topColor:{value:new THREE.Color(0x4fc3f7)},
    bottomColor:{value:new THREE.Color(0xffe0b2)}
  },
  vertexShader:`
    varying vec3 vPos;
    void main(){
      vPos=position;
      gl_Position=projectionMatrix*
      modelViewMatrix*vec4(position,1.0);
    }
  `,
  fragmentShader:`
    uniform vec3 topColor;
    uniform vec3 bottomColor;
    varying vec3 vPos;
    void main(){
      float h=normalize(vPos).y;
      gl_FragColor=vec4(
        mix(bottomColor,topColor,max(h,0.0)),1.0);
    }
  `
});
scene.add(new THREE.Mesh(skyGeo,skyMat));
scene.add(new THREE.AmbientLight(0xffffff,1));

// Fake Cursor
const cursor = new THREE.Mesh(
  new THREE.SphereGeometry(0.3,20,20),
  new THREE.MeshStandardMaterial({color:0xff4444})
);
scene.add(cursor);

// ---------- VR SPLIT RENDER ----------
function render(){
  requestAnimationFrame(render);

  const w = window.innerWidth;
  const h = window.innerHeight;

  // LEFT EYE
  renderer.setViewport(0,0,w/2,h);
  renderer.setScissor(0,0,w/2,h);
  renderer.render(scene,camera);

  // RIGHT EYE
  renderer.setViewport(w/2,0,w/2,h);
  renderer.setScissor(w/2,0,w/2,h);
  renderer.render(scene,camera);
}
render();

window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

// ---------- HAND TRACKING ----------
const video=document.getElementById("video");
const hands=new Hands({
  locateFile:file=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});
hands.setOptions({
  maxNumHands:1,
  modelComplexity:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

const buttons=document.querySelectorAll(".menuItem");

hands.onResults(results=>{
  if(results.multiHandLandmarks?.length){
    const l=results.multiHandLandmarks[0];
    const index=l[8];
    const thumb=l[4];

    cursor.position.x=(index.x-0.5)*8;
    cursor.position.y=-(index.y-0.5)*4;

    const pinchDist=Math.hypot(
      index.x-thumb.x,
      index.y-thumb.y
    );

    const screenX=index.x*window.innerWidth;
    const screenY=index.y*window.innerHeight;

    buttons.forEach(btn=>{
      const r=btn.getBoundingClientRect();
      const dist=Math.hypot(
        screenX-(r.left+r.width/2),
        screenY-(r.top+r.height/2)
      );

      if(dist<100){
        btn.classList.add("hover");
        if(pinchDist<0.05){
          btn.classList.add("active");
          setTimeout(()=>btn.classList.remove("active"),400);
        }
      }else{
        btn.classList.remove("hover");
      }
    });
  }
});

// ---------- ULTRA WIDE CAMERA ----------
async function start(){
  const stream=await navigator.mediaDevices.getUserMedia({
    video:{
      facingMode:"environment",
      width:{ideal:1920},
      height:{ideal:1080}
    }
  });
  video.srcObject=stream;
  await video.play();

  async function loop(){
    await hands.send({image:video});
    requestAnimationFrame(loop);
  }
  loop();
}
start();
</script>
</body>
</html>
